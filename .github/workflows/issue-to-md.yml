name: Issue to Markdown

on:
  issues:
    types: [opened]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set variables
        run: |
          # Issueタイトルから日付を抽出 (YYYY-MM-DD)
          DATE=$(echo "${{ github.event.issue.title }}" | grep -Eo '[0-9]{4}-[0-9]{2}-[0-9]{2}')
          if [ -z "$DATE" ]; then
            echo "Error: タイトルに YYYY-MM-DD が含まれていません"
            exit 1
          fi
          YEAR=$(echo $DATE | cut -d'-' -f1)
          MONTH=$(echo $DATE | cut -d'-' -f2)
          echo "DATE=$DATE"
          echo "YEAR=$YEAR"
          echo "MONTH=$MONTH"

          # 年/月ディレクトリ作成
          mkdir -p $YEAR/$MONTH

          # Markdown ファイル作成（Issue 本文を直接書き込む）
          FILE="$YEAR/$MONTH/$DATE.md"
          echo "# $DATE" > "$FILE"
          echo "" >> "$FILE"
          echo "${{ github.event.issue.body }}" >> "$FILE"

      - name: Commit and push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Add diary: $DATE"
          push_options: '--force'

